<!DOCTYPE html>
<html lang="vi" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SMMO - Thi√™n C∆° C√°c | Celestial Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Philosopher:ital,wght@0,400;0,700;1,400&family=Manrope:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              display: ["Philosopher", "sans-serif"],
              num: ["Cinzel", "serif"],
              body: ["Manrope", "sans-serif"],
            },
            colors: {
              void: "#050505",
              gold: {
                DEFAULT: "#d4af37",
                glow: "#fcd34d",
                dim: "#785c15",
              },
              glass: {
                surface: "rgba(20, 20, 25, 0.7)",
                border: "rgba(255, 255, 255, 0.08)",
                highlight: "rgba(255, 255, 255, 0.03)",
              },
            },
            animation: {
              "spin-slow": "spin 20s linear infinite",
              float: "float 6s ease-in-out infinite",
              pulse: "pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite",
              shimmer: "shimmer 2s linear infinite",
            },
            keyframes: {
              float: {
                "0%, 100%": { transform: "translateY(0)" },
                "50%": { transform: "translateY(-10px)" },
              },
              shimmer: {
                "0%": { backgroundPosition: "-1000px 0" },
                "100%": { backgroundPosition: "1000px 0" },
              },
            },
          },
        },
      };
    </script>
    <style>
      /* --- GLOBAL EFFECTS --- */
      body {
        background-color: #050505;
        background-image: radial-gradient(
            circle at 50% 0%,
            rgba(212, 175, 55, 0.15) 0%,
            transparent 50%
          ),
          url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
        color: #e5e7eb;
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.02);
      }
      ::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: rgba(212, 175, 55, 0.5);
      }

      /* Glass Card Utility */
      .glass-panel {
        background: rgba(20, 20, 25, 0.7);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
      }

      .glass-panel:hover {
        border-color: rgba(212, 175, 55, 0.3);
        box-shadow: 0 0 40px rgba(212, 175, 55, 0.05);
      }

      /* Rarity Colors (Text & Shadows) */
      .rarity-Common {
        color: #9ca3af;
      }
      .rarity-Uncommon {
        color: #34d399;
      }
      .rarity-Rare {
        color: #60a5fa;
      }
      .rarity-Elite {
        color: #a78bfa;
      }
      .rarity-Epic {
        color: #e879f9;
      }
      .rarity-Legendary {
        color: #fbbf24;
      }
      .rarity-Celestial {
        color: #f87171;
      }

      /* Utilities */
      .text-glow {
        text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
      }
      .clip-diagonal {
        clip-path: polygon(
          10px 0,
          100% 0,
          100% calc(100% - 10px),
          calc(100% - 10px) 100%,
          0 100%,
          0 10px
        );
      }

      /* Shimmer effect */
      .shimmer {
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0) 0%,
          rgba(255, 255, 255, 0.1) 50%,
          rgba(255, 255, 255, 0) 100%
        );
        background-size: 1000px 100%;
        animation: shimmer 2s infinite;
      }

      /* Loading skeleton */
      @keyframes pulse-subtle {
        0%,
        100% {
          opacity: 0.4;
        }
        50% {
          opacity: 0.6;
        }
      }
      .skeleton {
        animation: pulse-subtle 2s ease-in-out infinite;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.05) 25%,
          rgba(255, 255, 255, 0.1) 50%,
          rgba(255, 255, 255, 0.05) 75%
        );
        background-size: 200% 100%;
      }
    </style>
  </head>
  <body
    class="font-body min-h-screen p-4 md:p-8 selection:bg-gold selection:text-black flex flex-col items-center"
  >
    <main class="w-full max-w-7xl relative z-10">
      <header
        class="flex flex-col md:flex-row justify-between items-end mb-10 pb-6 border-b border-white/5 relative"
      >
        <div class="relative z-10">
          <div class="flex items-center gap-3 mb-1">
            <div class="h-px w-8 bg-gold"></div>
            <span class="text-gold font-num text-xs tracking-[0.3em] uppercase"
              >System V3.0</span
            >
          </div>
          <h1
            class="text-5xl md:text-7xl font-display font-bold text-transparent bg-clip-text bg-gradient-to-b from-[#fffbeb] via-[#d4af37] to-[#785c15] drop-shadow-sm"
          >
            THI√äN C∆† C√ÅC
          </h1>
        </div>

        <div
          class="flex items-center gap-4 mt-4 md:mt-0 glass-panel px-4 py-2 rounded-full"
        >
          <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
          <select
            id="profileSelect"
            title="Ch·ªçn h·ªì s∆° ng∆∞·ªùi ch∆°i"
            onchange="switchProfile()"
            class="bg-transparent border-none outline-none text-sm font-bold text-gray-300 cursor-pointer hover:text-gold transition font-display uppercase tracking-wider"
          >
            <option value="1283624" class="bg-black">LuNu (Main)</option>
            <option value="1284859" class="bg-black">Account Clone</option>
          </select>
        </div>
      </header>

      <div class="relative mb-12 group">
        <div
          class="absolute inset-0 bg-gold/20 blur-2xl rounded-full opacity-0 group-hover:opacity-100 transition duration-700"
        ></div>
        <div
          class="glass-panel p-2 rounded-2xl flex items-center relative z-10"
        >
          <div class="pl-6 text-2xl animate-float">üîÆ</div>
          <input
            type="number"
            id="playerSearchInput"
            placeholder="Nh·∫≠p ID ƒê·∫°o H·ªØu ƒë·ªÉ truy v·∫•n..."
            class="w-full bg-transparent border-none outline-none text-lg px-4 py-3 text-white placeholder-gray-600 font-display"
            onkeypress="handleEnter(event)"
          />
          <button
            onclick="searchPlayer()"
            class="bg-white/5 hover:bg-gold hover:text-black text-gold border border-gold/30 px-8 py-3 rounded-xl font-bold font-num transition-all duration-300 uppercase tracking-widest clip-diagonal"
          >
            Soi
          </button>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-auto lg:h-[800px]">
        <div
          class="lg:col-span-4 glass-panel rounded-3xl p-1 flex flex-col h-full relative overflow-hidden group"
        >
          <div
            class="absolute top-0 w-full h-1 bg-gradient-to-r from-transparent via-gold to-transparent opacity-50"
          ></div>

          <div
            class="relative h-[40%] bg-gradient-to-b from-white/5 to-transparent rounded-t-[20px] flex flex-col items-center justify-center p-6 border-b border-white/5"
          >
            <div class="relative w-32 h-32 md:w-40 md:h-40">
              <div
                class="absolute inset-0 border border-gold/30 rounded-full animate-spin-slow"
                style="border-style: dashed"
              ></div>
              <div
                class="absolute -inset-2 border border-white/10 rounded-full"
              ></div>
              <img
                id="pAvatar"
                src="https://web.simple-mmo.com/img/loading.gif"
                alt="Player avatar"
                class="w-full h-full rounded-full object-cover border-4 border-[#121212] shadow-2xl relative z-10"
              />
              <div
                class="absolute -bottom-4 left-1/2 -translate-x-1/2 bg-black border border-gold text-gold font-num font-bold px-3 py-1 rounded text-xs shadow-lg z-20 whitespace-nowrap"
                id="pLevelBadge"
              >
                Loading...
              </div>
            </div>

            <h2
              id="pName"
              class="mt-6 text-3xl font-display font-bold text-white tracking-wide"
            >
              ---
            </h2>
            <div
              id="pGuild"
              class="text-xs text-gray-500 font-bold uppercase tracking-[0.2em] mt-1"
            >
              ---
            </div>
          </div>

          <div
            class="flex-1 p-6 grid grid-cols-2 gap-3 content-center bg-black/20"
          >
            <div
              class="bg-white/5 p-4 rounded-xl border border-white/5 hover:border-red-500/50 transition group/stat"
            >
              <div
                class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-2"
              >
                S·ª©c M·∫°nh
              </div>
              <div
                id="pStr"
                class="text-2xl font-num font-bold text-red-400 group-hover/stat:text-red-300 transition"
              >
                ---
              </div>
            </div>
            <div
              class="bg-white/5 p-4 rounded-xl border border-white/5 hover:border-blue-500/50 transition group/stat"
            >
              <div
                class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-2"
              >
                Ph√≤ng Th·ªß
              </div>
              <div
                id="pDef"
                class="text-2xl font-num font-bold text-blue-400 group-hover/stat:text-blue-300 transition"
              >
                ---
              </div>
            </div>
            <div
              class="bg-white/5 p-4 rounded-xl border border-white/5 hover:border-emerald-500/50 transition group/stat"
            >
              <div
                class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-2"
              >
                Kh√©o L√©o
              </div>
              <div
                id="pDex"
                class="text-2xl font-num font-bold text-emerald-400 group-hover/stat:text-emerald-300 transition"
              >
                ---
              </div>
            </div>
            <div
              class="bg-white/5 p-4 rounded-xl border border-white/5 hover:border-gold/50 transition group/stat"
            >
              <div
                class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-2"
              >
                T√†i Ph√∫
              </div>
              <div
                id="pGold"
                class="text-xl font-num font-bold text-gold truncate group-hover/stat:text-yellow-200 transition"
              >
                ---
              </div>
            </div>
          </div>
        </div>

        <div
          class="lg:col-span-4 glass-panel rounded-3xl flex flex-col h-full overflow-hidden"
        >
          <div
            class="p-6 border-b border-white/5 flex justify-between items-center bg-white/[0.02]"
          >
            <h3
              class="font-display font-bold text-gold text-lg tracking-widest flex items-center gap-2"
            >
              <span class="text-xl">‚öîÔ∏è</span> H√ÄNH TRANG
            </h3>
            <span
              id="equipStatus"
              class="font-num text-xs text-gray-500 bg-white/5 px-2 py-1 rounded"
              >0 items</span
            >
          </div>
          <div
            id="pEquip"
            class="flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar"
          ></div>
        </div>

        <div
          class="lg:col-span-4 glass-panel rounded-3xl flex flex-col h-full overflow-hidden"
        >
          <div class="p-6 border-b border-white/5 bg-white/[0.02]">
            <h3
              class="font-display font-bold text-gold text-lg tracking-widest flex items-center gap-2"
            >
              <span class="text-xl">üìú</span> K·ª∏ NƒÇNG
            </h3>
          </div>
          <div
            id="pSkills"
            class="flex-1 overflow-y-auto p-6 space-y-5 custom-scrollbar"
          ></div>
        </div>
      </div>

      <section
        class="mt-12 glass-panel rounded-3xl p-1 md:p-1 relative overflow-hidden"
      >
        <div
          class="bg-[#080808] rounded-[20px] p-8 md:p-12 border border-white/5 relative z-10"
        >
          <div class="max-w-xl mx-auto text-center mb-12">
            <h2
              class="text-2xl font-display font-bold text-gold mb-2 uppercase tracking-[0.2em]"
            >
              Gi√°m ƒê·ªãnh B·∫£o V·∫≠t
            </h2>
            <div
              class="h-px w-24 bg-gradient-to-r from-transparent via-gray-700 to-transparent mx-auto mb-8"
            ></div>

            <div class="flex relative group">
              <div
                class="absolute -inset-1 bg-gradient-to-r from-gold to-orange-600 rounded-lg blur opacity-20 group-hover:opacity-40 transition"
              ></div>
              <input
                type="number"
                id="itemIdInput"
                placeholder="ID Th·∫ßn Kh√≠ (VD: 3979)"
                class="relative z-10 bg-black border border-white/10 text-white p-4 w-full rounded-l-lg outline-none font-num focus:border-gold transition placeholder-gray-700"
              />
              <button
                onclick="lookupItem()"
                class="relative z-10 bg-gold text-black font-bold px-8 py-4 rounded-r-lg hover:bg-white transition uppercase tracking-wider font-display"
              >
                Khai M·ªü
              </button>
            </div>
          </div>

          <div id="itemResult" class="hidden animate-float">
            <div
              class="max-w-4xl mx-auto glass-panel rounded-2xl overflow-hidden relative border border-white/10 flex flex-col md:flex-row"
            >
              <div
                id="cardBgGlow"
                class="absolute top-0 right-0 w-[600px] h-[600px] rounded-full blur-[100px] opacity-20 pointer-events-none translate-x-1/2 -translate-y-1/2"
              ></div>

              <div
                class="md:w-1/3 p-10 flex flex-col items-center justify-center border-b md:border-b-0 md:border-r border-white/5 bg-black/20 relative"
              >
                <span
                  id="bgRankLetter"
                  class="absolute font-display font-black text-[15rem] opacity-[0.02] select-none scale-150"
                  >S</span
                <img
                  id="itemImg"
                  src=""
                  alt="Item image"
                  class="w-32 h-32 object-contain drop-shadow-[0_0_30px_rgba(255,255,255,0.1)] z-10 relative transition hover:scale-110 duration-500"
                />
                />
                <span
                  id="itemRarityBadge"
                  class="mt-8 z-10 px-4 py-1 rounded border text-[10px] font-bold uppercase tracking-[0.3em] bg-black/50 backdrop-blur-md"
                  >Legendary</span
                >
              </div>

              <div class="md:w-2/3 p-8 md:p-10 relative z-10">
                <div class="flex justify-between items-start mb-6">
                  <div>
                    <div
                      id="itemType"
                      class="text-[10px] font-bold uppercase tracking-widest text-gold mb-2 opacity-80"
                    >
                      Weapon
                    </div>
                    <h2
                      id="itemName"
                      class="text-4xl font-display font-bold text-white leading-none"
                    >
                      Demon Sword
                    </h2>
                  </div>
                  <div id="itemValue" class="text-right">
                    <div class="text-[10px] text-gray-500 uppercase">
                      Gi√° tr·ªã
                    </div>
                    <div class="font-num text-xl text-gray-300">1,000,000</div>
                  </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-8">
                  <div class="bg-white/5 p-3 rounded border border-white/5">
                    <div class="text-[10px] text-gray-500 uppercase mb-1">
                      Th·ªã tr∆∞·ªùng (Min)
                    </div>
                    <div id="marketLow" class="font-num text-gold font-bold">
                      ---
                    </div>
                  </div>
                  <div class="bg-white/5 p-3 rounded border border-white/5">
                    <div class="text-[10px] text-gray-500 uppercase mb-1">
                      Th·ªã tr∆∞·ªùng (Max)
                    </div>
                    <div
                      id="marketHigh"
                      class="font-num text-blue-400 font-bold"
                    >
                      ---
                    </div>
                  </div>
                </div>

                <div class="border-t border-white/10 pt-6">
                  <div
                    class="text-[10px] text-gray-500 uppercase font-bold mb-3 flex items-center gap-2"
                  >
                    <span class="w-1 h-1 bg-gold rounded-full"></span> Thu·ªôc
                    t√≠nh ·∫©n
                  </div>
                  <div id="itemStats" class="flex gap-6"></div>
                </div>
              </div>
            </div>
          </div>

          <div id="itemError" class="hidden text-center mt-8">
            <p class="text-red-400 font-display text-lg tracking-wider">
              ‚ö†Ô∏è V·∫≠t ph·∫©m kh√¥ng t·ªìn t·∫°i trong d√≤ng th·ªùi gian n√†y.
            </p>
          </div>
        </div>
      </section>

      <footer class="mt-12 text-center text-gray-600 text-xs font-num py-8">
        THI√äN C∆† C√ÅC ¬© 2025 ‚Ä¢ DESIGNED FOR SMMO
      </footer>
    </main>

    <script>
      /* === LOGIC JAVASCRIPT === */

      // Map t√™n ti·∫øng Vi·ªát cho c√°c slot trang b·ªã v·ªõi icon
      const slotNameMap = {
        helmet: { name: "M≈©", icon: "ü™ñ" },
        armour: { name: "√Åo Gi√°p", icon: "üõ°Ô∏è" },
        weapon: { name: "V≈© Kh√≠", icon: "‚öîÔ∏è" },
        shield: { name: "Khi√™n", icon: "üõ°Ô∏è" },
        boots: { name: "Gi√†y", icon: "üë¢" },
        legs: { name: "Qu·∫ßn", icon: "üëñ" },
        amulet: { name: "D√¢y Chuy·ªÅn", icon: "üìø" },
        ring_1: { name: "Nh·∫´n 1", icon: "üíç" },
        ring_2: { name: "Nh·∫´n 2", icon: "üíç" },
      };

      // C·∫•u h√¨nh m√†u s·∫Øc theo ƒë·ªô hi·∫øm
      const RARITY_DATA = {
        Common: {
          color: "text-gray-400",
          bg: "bg-gray-500",
          glow: "rgba(156, 163, 175, 0.3)",
        },
        Uncommon: {
          color: "text-emerald-400",
          bg: "bg-emerald-500",
          glow: "rgba(52, 211, 153, 0.3)",
        },
        Rare: {
          color: "text-blue-400",
          bg: "bg-blue-500",
          glow: "rgba(96, 165, 250, 0.4)",
        },
        Elite: {
          color: "text-purple-400",
          bg: "bg-purple-500",
          glow: "rgba(167, 139, 250, 0.4)",
        },
        Epic: {
          color: "text-pink-400",
          bg: "bg-pink-500",
          glow: "rgba(232, 121, 249, 0.5)",
        },
        Legendary: {
          color: "text-yellow-400",
          bg: "bg-yellow-500",
          glow: "rgba(251, 191, 36, 0.6)",
        },
        Celestial: {
          color: "text-red-500",
          bg: "bg-red-600",
          glow: "rgba(248, 113, 113, 0.7)",
        },
      };

      let currentId = 1283624;
      let isLoading = false;

      // H√†m fetch proxy v·ªõi error handling
      async function fetchProxy(endpoint) {
        try {
          const res = await fetch(`/api/proxy/${endpoint}`);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return await res.json();
        } catch (e) {
          console.error("Fetch error:", e);
          return null;
        }
      }

      // Animate number v·ªõi easing
      function animateNumber(element, targetValue, duration = 1000) {
        const start = parseInt(element.innerText.replace(/,/g, "")) || 0;
        const startTime = performance.now();

        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const eased = 1 - Math.pow(1 - progress, 3);
          const current = Math.floor(start + (targetValue - start) * eased);
          element.innerText = current.toLocaleString();

          if (progress < 1) requestAnimationFrame(update);
        }
        requestAnimationFrame(update);
      }

      function handleEnter(e) {
        if (e.key === "Enter") searchPlayer();
      }

      function switchProfile() {
        if (isLoading) return;
        currentId = document.getElementById("profileSelect").value;
        document.getElementById("playerSearchInput").value = "";
        loadData(currentId);
      }

      function searchPlayer() {
        if (isLoading) return;
        const inputId = document
          .getElementById("playerSearchInput")
          .value.trim();
        if (inputId && /^\d+$/.test(inputId)) loadData(inputId);
        else alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ID h·ª£p l·ªá (ch·ªâ s·ªë)");
      }

      /* --- RENDER FUNCTIONS --- */

      function createEquipCard(slot, data) {
        const slotInfo = slotNameMap[slot] || { name: slot, icon: "üì¶" };

        // Render Empty Slot
        if (!data || !data.name) {
          return `
            <div class="group flex items-center gap-4 p-4 rounded-xl border-2 border-dashed border-white/10 text-gray-600 hover:border-white/20 transition-all duration-300 hover:bg-white/[0.02]">
                <div class="w-14 h-14 bg-gradient-to-br from-white/5 to-white/[0.02] rounded-xl flex items-center justify-center text-2xl group-hover:scale-110 transition-transform duration-300 border border-white/10">
                    ${slotInfo.icon}
                </div>
                <div class="flex-1">
                    <div class="text-xs font-bold uppercase tracking-wider text-gray-500">${slotInfo.name}</div>
                    <div class="text-[10px] text-gray-700 font-display italic mt-0.5">Tr·ªëng</div>
                </div>
            </div>`;
        }

        let img = data.image_url;
        if (img && !img.startsWith("http"))
          img = "https://web.simple-mmo.com" + img;

        const rarityKey = data.rarity || "Common";
        const rarityClass = `rarity-${rarityKey}`;
        const rarityData = RARITY_DATA[rarityKey];

        // Build stats HTML
        let statsHtml = "";
        const statBadge = (stat, mod) => `
          <span class="inline-flex items-center gap-1 text-[10px] bg-gradient-to-r from-white/10 to-white/5 text-gray-200 px-2 py-1 rounded-md font-bold border border-white/10">
            <span class="text-emerald-400">‚ñ≤</span>${stat
              .substr(0, 3)
              .toUpperCase()} +${mod}
          </span>`;

        if (data.stat1) statsHtml += statBadge(data.stat1, data.stat1modifier);
        if (data.stat2)
          statsHtml += ` ${statBadge(data.stat2, data.stat2modifier)}`;

        return `
          <div class="group relative flex items-center gap-4 p-4 rounded-xl bg-gradient-to-br from-white/[0.04] to-white/[0.01] border border-white/10 hover:border-${
            rarityKey === "Common" ? "white" : rarityData.bg.replace("bg-", "")
          }/30 transition-all duration-300 cursor-pointer overflow-hidden">
             <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 shimmer"></div>
                <img src="${img}" alt="Equipment item" class="w-12 h-12 object-contain relative z-10 drop-shadow-lg">
             <div class="relative w-14 h-14 bg-black/40 rounded-xl border-2 border-white/20 flex items-center justify-center shrink-0 overflow-hidden group-hover:scale-110 group-hover:rotate-3 transition-all duration-300">
                <img src="${img}" class="w-12 h-12 object-contain relative z-10 drop-shadow-lg">
                <div class="absolute inset-0 bg-gradient-to-t from-${
                  rarityData.bg
                }/20 to-transparent"></div>
             </div>
             
             <div class="flex-1 min-w-0 relative z-10">
                <div class="flex justify-between items-start mb-1">
                    <div class="font-display font-bold text-sm ${rarityClass} truncate pr-2 group-hover:brightness-125 transition drop-shadow-sm">${
          data.name
        }</div>
                    <div class="text-[9px] text-gray-500 uppercase font-bold tracking-wider bg-black/30 px-2 py-0.5 rounded">${
                      slotInfo.name
                    }</div>
                </div>
                <div class="flex justify-between items-center mt-2">
                    <div class="flex items-center gap-1 flex-wrap">${statsHtml}</div>
                    <div class="font-num text-[10px] text-gold/90 font-bold bg-gold/10 px-2 py-1 rounded">${
                      data.market?.low ? data.market.low.toLocaleString() : "-"
                    } G</div>
                </div>
             </div>
          </div>
        `;
      }

      async function loadData(id) {
        if (isLoading) return;
        isLoading = true;

        // UI Loading States
        document.getElementById("pName").innerText = "ƒêang ƒë·ªìng b·ªô...";
        document.getElementById("pAvatar").src =
          "https://web.simple-mmo.com/img/loading.gif";
        document.getElementById("pEquip").innerHTML = `
            <div class="space-y-3">
                ${[1, 2, 3, 4]
                  .map(() => '<div class="h-20 skeleton rounded-xl"></div>')
                  .join("")}
            </div>`;
        document.getElementById("pSkills").innerHTML = `
            <div class="space-y-4">
                ${[1, 2, 3]
                  .map(() => '<div class="h-16 skeleton rounded-xl"></div>')
                  .join("")}
            </div>`;

        // 1. Fetch Basic Info
        const info = await fetchProxy(`player/info/${id}`);

        if (info && !info.error) {
          document.getElementById("pName").innerText = info.name;
          document.getElementById("pLevelBadge").innerText = `LV.${info.level}`;
          document.getElementById("pGuild").innerText = info.guild
            ? info.guild.name
            : "V√¥ Danh";

          // Animate numbers
          const strTotal = info.str + (info.bonus_str || 0);
          const defTotal = info.def + (info.bonus_def || 0);
          const dexTotal = info.dex + (info.bonus_dex || 0);

          animateNumber(document.getElementById("pStr"), strTotal);
          animateNumber(document.getElementById("pDef"), defTotal);
          animateNumber(document.getElementById("pDex"), dexTotal);
          animateNumber(document.getElementById("pGold"), info.gold);

          let avt = info.avatar;
          if (avt && !avt.startsWith("http"))
            avt = "https://web.simple-mmo.com" + avt;
          document.getElementById("pAvatar").src = avt;
        } else {
          document.getElementById("pName").innerText = "Kh√¥ng t·ªìn t·∫°i";
          document.getElementById("pAvatar").src =
            "https://via.placeholder.com/150/000000/FFFFFF/?text=?";
          document.getElementById(
            "pEquip"
          ).innerHTML = `<div class="text-center text-red-400 py-10 font-display">‚ùå Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi ch∆°i</div>`;
          document.getElementById(
            "pSkills"
          ).innerHTML = `<div class="text-center text-red-400 py-10 font-display">‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu</div>`;
          isLoading = false;
          return;
        }

        // 2. Fetch Equipment
        const equipsContainer = document.getElementById("pEquip");
        const equips = await fetchProxy(`player/equipment/${id}`);

        if (equips && Object.keys(equips).length) {
          equipsContainer.innerHTML = "";
          let count = 0;
          const sortedSlots = [
            "helmet",
            "amulet",
            "weapon",
            "armour",
            "shield",
            "legs",
            "boots",
            "ring_1",
            "ring_2",
          ];

          for (let slot of sortedSlots) {
            let item = equips[slot];
            if (item) {
              count++;
              let itemId =
                typeof item === "object" ? item.id || item.item_id : item;

              const divId = `slot-${slot}`;
              const skeleton = document.createElement("div");
              skeleton.id = divId;
              skeleton.className = "h-20 skeleton rounded-xl mb-2";
              equipsContainer.appendChild(skeleton);

              fetchProxy(`item/info/${itemId}`).then((d) => {
                const el = document.getElementById(divId);
                if (el) el.outerHTML = createEquipCard(slot, d);
              });
            } else {
              equipsContainer.innerHTML += createEquipCard(slot, {});
            }
          }
          document.getElementById("equipStatus").innerText = `${count} m√≥n`;
        } else {
          equipsContainer.innerHTML = `<div class="text-center text-gray-600 py-10 font-display italic">T√∫i h√†nh trang tr·ªëng r·ªóng</div>`;
        }

        // 3. Fetch Skills
        const skills = await fetchProxy(`player/skills/${id}`);
        const skillsContainer = document.getElementById("pSkills");
        skillsContainer.innerHTML = "";

        if (skills && Array.isArray(skills) && skills.length > 0) {
          skills.sort((a, b) => b.level - a.level);
          skills.forEach((s) => {
            const progress = Math.min(100, (s.level / 100) * 100);
            skillsContainer.innerHTML += `
                    <div class="group relative">
                        <div class="flex justify-between items-end mb-2">
                            <span class="font-display font-bold text-gray-200 capitalize text-base group-hover:text-emerald-300 transition">${
                              s.skill
                            }</span>
                            <span class="font-num font-bold text-emerald-400 text-xs bg-emerald-500/10 px-3 py-1 rounded-full border border-emerald-500/30">Lv.${
                              s.level
                            }</span>
                        </div>
                        <div class="h-2 w-full bg-white/10 rounded-full overflow-hidden border border-white/10">
                            <div class="h-full bg-gradient-to-r from-emerald-600 via-emerald-400 to-emerald-300 transition-all duration-1000 ease-out" style="width: ${progress}%"></div>
                        </div>
                        <div class="text-[10px] text-right text-gray-500 mt-1.5 font-num tracking-wider">${s.exp.toLocaleString()} XP</div>
                    </div>
                `;
          });
        } else {
          skillsContainer.innerHTML = `<div class="text-center text-gray-600 py-10 font-display italic">Ch∆∞a tu luy·ªán k·ªπ nƒÉng n√†o</div>`;
        }

        isLoading = false;
      }

      /* --- ITEM LOOKUP LOGIC --- */
      async function lookupItem() {
        const id = document.getElementById("itemIdInput").value.trim();
        if (!id || !/^\d+$/.test(id)) {
          alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ID h·ª£p l·ªá");
          return;
        }

        const resEl = document.getElementById("itemResult");
        const errEl = document.getElementById("itemError");

        resEl.classList.add("hidden");
        errEl.classList.add("hidden");

        const data = await fetchProxy(`item/info/${id}`);

        if (!data || data.error) {
          errEl.classList.remove("hidden");
          return;
        }

        resEl.classList.remove("hidden");

        // Populate Data
        document.getElementById("itemName").innerText = data.name;
        document.getElementById(
          "itemName"
        ).className = `text-4xl font-display font-bold leading-none rarity-${
          data.rarity || "Common"
        }`;
        document.getElementById("itemType").innerText = data.type || "Unknown";
        document.getElementById(
          "itemValue"
        ).innerHTML = `<div class="text-[10px] text-gray-500 uppercase">Gi√° NPC</div><div class="font-num text-xl text-gray-300">${
          data.value?.toLocaleString() || "N/A"
        }</div>`;
        document.getElementById("marketLow").innerText =
          data.market?.low?.toLocaleString() || "---";
        document.getElementById("marketHigh").innerText =
          data.market?.high?.toLocaleString() || "---";

        // Image
        let img = data.image_url;
        if (img && !img.startsWith("http"))
          img = "https://web.simple-mmo.com" + img;
        document.getElementById("itemImg").src = img;

        // Rarity Styling
        const rarity = data.rarity || "Common";
        const rarityColor = RARITY_DATA[rarity] || RARITY_DATA["Common"];
        const badge = document.getElementById("itemRarityBadge");

        badge.innerText = rarity;
        badge.className = `mt-8 z-10 px-4 py-1.5 rounded-full border text-[10px] font-bold uppercase tracking-[0.3em] backdrop-blur-md shadow-lg ${rarityColor.color} border-current bg-black/60`;

        // Background Glow
        const bgGlow = document.getElementById("cardBgGlow");
        let glowColor = "bg-gray-500";
        if (rarity === "Legendary") glowColor = "bg-yellow-500";
        if (rarity === "Celestial") glowColor = "bg-red-600";
        if (rarity === "Epic") glowColor = "bg-pink-500";
        if (rarity === "Elite") glowColor = "bg-purple-500";
        if (rarity === "Rare") glowColor = "bg-blue-500";
        if (rarity === "Uncommon") glowColor = "bg-emerald-500";
        bgGlow.className = `absolute top-0 right-0 w-[600px] h-[600px] rounded-full blur-[120px] opacity-10 pointer-events-none translate-x-1/2 -translate-y-1/2 transition-colors duration-1000 ${glowColor}`;

        // Big Letter
        const rankLetter = document.getElementById("bgRankLetter");
        rankLetter.innerText = rarity.charAt(0);
        rankLetter.className = `absolute font-display font-black text-[15rem] opacity-[0.05] select-none scale-150 ${rarityColor.color}`;

        // Stats
        const statsContainer = document.getElementById("itemStats");
        let stats = [];
        const statFmt = (n, v) => `
            <div class="flex items-center gap-2 bg-gradient-to-br from-white/10 to-white/5 px-4 py-2 rounded-lg border border-white/10 hover:border-emerald-400/30 transition">
                <span class="text-gold text-xs">‚óÜ</span> 
                <span class="text-gray-300 font-bold text-sm uppercase tracking-wide">${n}</span> 
                <span class="text-emerald-400 font-num text-base font-bold">+${v}</span>
            </div>`;

        if (data.stat1 && data.stat1 !== "none")
          stats.push(statFmt(data.stat1, data.stat1modifier));
        if (data.stat2 && data.stat2 !== "none")
          stats.push(statFmt(data.stat2, data.stat2modifier));

        if (stats.length > 0) {
          statsContainer.innerHTML = stats.join("");
        } else {
          statsContainer.innerHTML =
            '<span class="italic text-gray-600 text-xs font-display">V·∫≠t ph·∫©m th√¥ng th∆∞·ªùng, kh√¥ng ch·ª©a s·ª©c m·∫°nh ·∫©n.</span>';
        }
      }

      // Init
      loadData(currentId);
    </script>
  </body>
</html>
